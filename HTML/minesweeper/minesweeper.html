<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰«é›·æ¸¸æˆ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
  <style>
    body {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      font-family: 'Inter', sans-serif;
    }

    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url(./background.jpg);
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      filter: blur(7px);
      z-index: -1;
    }

    .cell {
      width: 30px;
      height: 30px;
      border: 1px solid #d9dde2;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
      background-color: #f7f7f8;
      box-shadow: none;
    }

    .cell:hover {
      background-color: #c3c7cc;
      transform: scale(1.05);
    }

    .revealed {
      background-color: #dee0e3;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .mine {
      color: #ef4444;
    }

    .flag {
      color: #2563eb;
    }

    .exploded {
      color: #ef4444;
      font-weight: bold;
    }

    .game-container {
      background-color: #ffffff;
      padding: 2rem;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .btn {
      background-color: #3b82f6;
      color: #ffffff;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      transition: background-color 0.2s ease-in-out;
    }

    .btn:hover {
      background-color: #2563eb;
    }

    select {
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      background-color: #f9fafb;
    }

    /* æ¨¡æ€æ¡†æ ·å¼ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease-in-out;
      z-index: 11; /* æ·»åŠ  z-indexï¼Œä½¿å…¶æ˜¾ç¤ºåœ¨åŠ¨ç”»å±‚ä¹‹ä¸Š */
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .modal-content {
      background-color: #fff;
      padding: 2rem;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      text-align: center;
      animation: slideUp 0.3s ease-in-out;
    }

    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-success {
      border: 2px solid #22c55e;
    }

    .modal-failure {
      border: 2px solid #ef4444;
    }

    .modal-title {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
      animation: scaleIn 0.5s ease-in-out;
    }

    @keyframes scaleIn {
      from {
        transform: scale(0.8);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .modal-success.title {
      color: #22c55e;
    }

    .modal-failure.title {
      color: #ef4444;
    }

    .modal-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      animation: spin 1s ease-in-out;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    .modal-success.icon {
      color: #22c55e;
    }

    .modal-failure.icon {
      color: #ef4444;
    }

    .modal-message {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
      animation: fadeInText 0.8s ease-in-out;
    }

    @keyframes fadeInText {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* æ¸¸æˆç»“æŸåŠ¨ç”» */
    .game-over-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    .game-over-success {
      background: rgba(34, 197, 94, 0.3);
    }

    .game-over-failure {
      background: rgba(239, 68, 68, 0.3);
    }

    .game-over-star {
      position: absolute;
      width: 10px;
      height: 10px;
      background: #fcd34d;
      border-radius: 50%;
      animation: starFall 2s linear infinite;
    }

    @keyframes starFall {
      0% {
        top: -10px;
        opacity: 1;
      }
      100% {
        top: 100%;
        opacity: 0;
      }
    }

    .game-over-explosion {
      position: absolute;
      width: 20px;
      height: 20px;
      background: #ef4444;
      border-radius: 50%;
      animation: explosion 1s ease-out;
    }

    @keyframes explosion {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(10);
        opacity: 0;
      }
    }
  </style>
</head>

<body class="flex justify-center items-center h-screen">
  <div class="game-container">
    <h1 class="text-2xl font-bold mb-4 text-center text-gray-800">æ‰«é›·æ¸¸æˆ</h1>
    <div class="mb-4 flex justify-center items-center space-x-4">
      <label for="difficulty" class="text-gray-700">é€‰æ‹©éš¾åº¦: </label>
      <select id="difficulty">
        <option value="beginner">åˆçº§ (9x9, 10 ä¸ªé›·)</option>
        <option value="intermediate">ä¸­çº§ (16x16, 40 ä¸ªé›·)</option>
        <option value="expert">é«˜çº§ (16x30, 99 ä¸ªé›·)</option>
      </select>
      <button id="start" class="btn">å¼€å§‹æ¸¸æˆ</button>
    </div>
    <div id="board" class="grid gap-1 justify-center"></div>
    <div class="flex justify-between mt-4">
      <div class="text-gray-700">å‰©ä½™åœ°é›·: <span id="mine-count">10</span></div>
      <button id="reset" class="btn">é‡ç½®</button>
    </div>
  </div>
  <!-- èƒœåˆ©æ¨¡æ€æ¡† -->
  <div id="success-modal" class="modal">
    <div class="modal-content modal-success">
      <i class="fa-solid fa-trophy modal-icon icon"></i>
      <h2 class="modal-title title">æ­å–œï¼å¤§è·å…¨èƒœğŸ‰</h2>
      <p class="modal-message">ä½ ä»¥è¶…å‡¡çš„æ™ºæ…§å’Œæ•é”çš„æ´å¯ŸåŠ›æˆåŠŸæ‰«é™¤æ‰€æœ‰åœ°é›·ï¼Œå ªç§°æ‰«é›·å¤§å¸ˆï¼</p>
      <button id="success-close" class="btn">å…³é—­</button>
      <button id="success-restart" class="btn mt-2">é‡æ–°å¼€å§‹</button>
    </div>
  </div>
  <!-- å¤±è´¥æ¨¡æ€æ¡† -->
  <div id="failure-modal" class="modal">
    <div class="modal-content modal-failure">
      <i class="fa-solid fa-bomb modal-icon icon"></i>
      <h2 class="modal-title title">é—æ†¾è´¥åŒ—ğŸ’¥</h2>
      <p class="modal-message">å¾ˆå¯æƒœï¼Œä½ ä¸å°å¿ƒè§¦å‘äº†åœ°é›·ã€‚ä¸è¿‡åˆ«æ°”é¦ï¼Œæ€»ç»“ç»éªŒï¼Œä¸‹æ¬¡ä¸€å®šèƒ½æˆåŠŸï¼</p>
      <button id="failure-close" class="btn">å…³é—­</button>
      <button id="failure-restart" class="btn mt-2">é‡æ–°å¼€å§‹</button>
    </div>
  </div>
  <!-- æ¸¸æˆç»“æŸåŠ¨ç”» -->
  <div id="game-over-success" class="game-over-animation game-over-success"></div>
  <div id="game-over-failure" class="game-over-animation game-over-failure"></div>
  <script>
    let rows, cols, mines;
    let board = [];
    let revealedCells = 0;
    let flaggedMines = 0;
    let firstClick = true;
    let gameOver = false;
    const boardElement = document.getElementById('board');
    const mineCountElement = document.getElementById('mine-count');
    const resetButton = document.getElementById('reset');
    const difficultySelect = document.getElementById('difficulty');
    const startButton = document.getElementById('start');
    const successModal = document.getElementById('success-modal');
    const failureModal = document.getElementById('failure-modal');
    const successCloseButton = document.getElementById('success-close');
    const failureCloseButton = document.getElementById('failure-close');
    const gameOverSuccess = document.getElementById('game-over-success');
    const gameOverFailure = document.getElementById('game-over-failure');
    const successRestartButton = document.getElementById('success-restart');
    const failureRestartButton = document.getElementById('failure-restart');

    function setDifficulty() {
      const difficulty = difficultySelect.value;
      switch (difficulty) {
        case 'beginner':
          rows = 9;
          cols = 9;
          mines = 10;
          break;
        case 'intermediate':
          rows = 16;
          cols = 16;
          mines = 40;
          break;
        case 'expert':
          rows = 16;
          cols = 30;
          mines = 99;
          break;
      }
    }

    function createBoard() {
      board = [];
      revealedCells = 0;
      flaggedMines = 0;
      firstClick = true;
      gameOver = false;
      mineCountElement.textContent = mines;
      boardElement.style.gridTemplateColumns = `repeat(${cols}, 30px)`;

      for (let i = 0; i < rows; i++) {
        const row = [];
        for (let j = 0; j < cols; j++) {
          row.push({
            isMine: false,
            isRevealed: false,
            isFlagged: false,
            adjacentMines: 0
          });
        }
        board.push(row);
      }
    }

    function placeMinesAfterFirstClick(clickedRow, clickedCol) {
      let minesPlaced = 0;
      while (minesPlaced < mines) {
        const randomRow = Math.floor(Math.random() * rows);
        const randomCol = Math.floor(Math.random() * cols);
        if (!board[randomRow][randomCol].isMine &&
          !(Math.abs(randomRow - clickedRow) <= 1 && Math.abs(randomCol - clickedCol) <= 1)) {
          board[randomRow][randomCol].isMine = true;
          minesPlaced++;
        }
      }

      // è®¡ç®—æ¯ä¸ªæ ¼å­å‘¨å›´çš„åœ°é›·æ•°é‡
      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
          if (!board[i][j].isMine) {
            board[i][j].adjacentMines = countAdjacentMines(i, j);
          }
        }
      }
    }

    function countAdjacentMines(row, col) {
      let count = 0;
      for (let i = Math.max(row - 1, 0); i <= Math.min(row + 1, rows - 1); i++) {
        for (let j = Math.max(col - 1, 0); j <= Math.min(col + 1, cols - 1); j++) {
          if (board[i][j].isMine) {
            count++;
          }
        }
      }
      return count;
    }

    function drawBoard() {
      boardElement.innerHTML = '';
      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          cell.dataset.row = i;
          cell.dataset.col = j;

          if (!gameOver) {
            cell.addEventListener('click', () => revealCell(i, j));
            cell.addEventListener('contextmenu', (e) => {
              e.preventDefault();
              toggleFlag(i, j);
            });
            cell.addEventListener('click', () => doubleClickCell(i, j));
          }

          if (board[i][j].isRevealed) {
            cell.classList.add('revealed');
            if (board[i][j].isMine) {
              if (board[i][j].isExploded) {
                cell.textContent = 'ğŸ’¥';
                cell.classList.add('exploded');
              } else {
                cell.textContent = 'ğŸ’£';
                cell.classList.add('mine');
              }
            } else if (board[i][j].adjacentMines > 0) {
              cell.textContent = board[i][j].adjacentMines;
            }
          } else if (board[i][j].isFlagged) {
            cell.textContent = 'ğŸš©';
            cell.classList.add('flag');
          }

          if (gameOver && board[i][j].isMine) {
            if (board[i][j].isExploded) {
              cell.textContent = 'ğŸ’¥';
              cell.classList.add('exploded');
            } else {
              cell.textContent = 'ğŸ’£';
              cell.classList.add('mine');
            }
          }

          boardElement.appendChild(cell);
        }
      }
    }

    function revealCell(row, col) {
      if (gameOver || board[row][col].isRevealed || board[row][col].isFlagged) return;

      if (firstClick) {
        placeMinesAfterFirstClick(row, col);
        firstClick = false;
      }

      board[row][col].isRevealed = true;
      revealedCells++;

      if (board[row][col].isMine) {
        // æ ‡è®°çˆ†ç‚¸çš„é›·
        board[row][col].isExploded = true;
        // æ¸¸æˆå¤±è´¥
        gameOver = true;
        showAllMines();
        failureModal.style.display = 'flex';
        showGameOverFailureAnimation();
        return;
      }

      if (board[row][col].adjacentMines === 0) {
        // é€’å½’æ­ç¤ºå‘¨å›´çš„æ ¼å­
        for (let i = Math.max(row - 1, 0); i <= Math.min(row + 1, rows - 1); i++) {
          for (let j = Math.max(col - 1, 0); j <= Math.min(col + 1, cols - 1); j++) {
            revealCell(i, j);
          }
        }
      }

      if (revealedCells === rows * cols - mines) {
        // æ¸¸æˆèƒœåˆ©
        gameOver = true;
        showAllMines();
        successModal.style.display = 'flex';
        showGameOverSuccessAnimation();
      }

      drawBoard();
    }

    function toggleFlag(row, col) {
      if (gameOver || board[row][col].isRevealed) return;

      if (board[row][col].isFlagged) {
        board[row][col].isFlagged = false;
        flaggedMines--;
      } else {
        board[row][col].isFlagged = true;
        flaggedMines++;
      }

      mineCountElement.textContent = mines - flaggedMines;
      drawBoard();
    }

    function showAllMines() {
      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
          if (board[i][j].isMine) {
            board[i][j].isRevealed = true;
          }
        }
      }
      drawBoard();
    }

    function doubleClickCell(row, col) {
      if (gameOver ||!board[row][col].isRevealed) return;

      let flaggedCount = 0;
      for (let i = Math.max(row - 1, 0); i <= Math.min(row + 1, rows - 1); i++) {
        for (let j = Math.max(col - 1, 0); j <= Math.min(col + 1, cols - 1); j++) {
          if (board[i][j].isFlagged) {
            flaggedCount++;
          }
        }
      }

      if (flaggedCount === board[row][col].adjacentMines) {
        for (let i = Math.max(row - 1, 0); i <= Math.min(row + 1, rows - 1); i++) {
          for (let j = Math.max(col - 1, 0); j <= Math.min(col + 1, cols - 1); j++) {
            if (!board[i][j].isFlagged) {
              revealCell(i, j);
            }
          }
        }
      }
    }

    function resetGame() {
      setDifficulty();
      createBoard();
      drawBoard();
      successModal.style.display = 'none';
      failureModal.style.display = 'none';
      gameOverSuccess.style.display = 'none';
      gameOverFailure.style.display = 'none';
    }

    function showGameOverSuccessAnimation() {
      gameOverSuccess.style.display = 'flex';
      for (let i = 0; i < 50; i++) {
        const star = document.createElement('div');
        star.classList.add('game-over-star');
        star.style.left = `${Math.random() * 100}%`;
        star.style.animationDelay = `${Math.random() * 2}s`;
        gameOverSuccess.appendChild(star);
      }
    }

    function showGameOverFailureAnimation() {
      gameOverFailure.style.display = 'flex';
      const explosion = document.createElement('div');
      explosion.classList.add('game-over-explosion');
      explosion.style.left = '50%';
      explosion.style.top = '50%';
      gameOverFailure.appendChild(explosion);
    }

    // åˆå§‹åŒ–æ¸¸æˆ
    setDifficulty();
    createBoard();
    drawBoard();

    startButton.addEventListener('click', resetGame);
    resetButton.addEventListener('click', resetGame);
    successCloseButton.addEventListener('click', () => {
      successModal.style.display = 'none';
      gameOverSuccess.style.display = 'none';
    });
    failureCloseButton.addEventListener('click', () => {
      failureModal.style.display = 'none';
      gameOverFailure.style.display = 'none';
    });
    successRestartButton.addEventListener('click', resetGame);
    failureRestartButton.addEventListener('click', resetGame);
  </script>
</body>

</html>
    
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小树的邀请函</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
            position: relative;
        }
        .container {
            text-align: center;
            max-width: 600px;
        }
        h1 { color: #333; margin-bottom: 10px; }
        p  { color: #666; margin-bottom: 30px; }
        .face-container { position: relative; width:200px; height:200px; margin:30px auto; }
        .face { width:200px; height:200px; border-radius:50%; background:linear-gradient(135deg,#f8d568,#c9e265); position:relative; overflow:hidden; box-shadow:0 5px 15px rgba(0,0,0,0.1); transition:background 0.5s ease; }
        .eyes { position:absolute; top:60px; width:100%; display:flex; justify-content:center; }
        .eye { width:40px; height:40px; background:white; border-radius:50%; margin:0 15px; position:relative; }
        .pupil { width:20px; height:20px; background:#3a2a1d; border-radius:50%; position:absolute; top:10px; left:10px; transition:transform 0.3s ease; }
        .mouth { position:absolute; width:80px; height:40px; background:#d64541; border-radius:0 0 40px 40px; bottom:50px; left:60px; overflow:hidden; transition:all 0.3s ease; }
        .tooth { width:20px; height:15px; background:white; position:absolute; top:0; left:30px; border-radius:0 0 5px 5px; }
        .cheeks { position:absolute; width:100%; top:100px; display:flex; justify-content:space-between; padding:0 30px; box-sizing:border-box; opacity:0; transition:opacity 0.3s; }
        .cheek { width:30px; height:20px; background:#f8a5a5; border-radius:50%; }
        .buttons { display:flex; justify-content:space-between; width:100%; max-width:400px; margin-top:30px; }
        .btn { padding:12px 30px; border:none; border-radius:5px; font-size:16px; cursor:pointer; transition:all 0.3s; color:white; font-weight:bold; position: relative; }
        .accept { background:#5cb85c; z-index:2; }
        .accept:hover { background:#4cae4c; }
        .reject {
            background:#d9534f;
            position:absolute;
            top:67%;
            left: calc(60%);
            z-index:1;
            transition:left 0.2s ease, top 0.2s ease;
        }
        .reject:hover { background:#c9302c; }
        .happy .mouth { border-radius:40px 40px 0 0; height:30px; bottom:60px; }
        .sad .mouth   { border-radius:0 0 40px 40px; height:30px; bottom:40px; }
        .sad .face    { background:linear-gradient(135deg,#f8d568,#c9e265 30%); }
        .happy .cheeks{ opacity:1; }
        /* Bounce animation for accept button */
        @keyframes bounce {
            0%, 100% { top: 0; }
            50% { top: -10px; }
        }
        .bounce {
            animation: bounce 0.4s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>小树向你发送了一封对象邀请函</h1>
        <p>小树希望你成为ta的对象，是否接受？</p>
        <div class="face-container">
            <div class="face" id="face">
                <div class="eyes">
                    <div class="eye"><div class="pupil" id="leftPupil"></div></div>
                    <div class="eye"><div class="pupil" id="rightPupil"></div></div>
                </div>
                <div class="mouth"><div class="tooth"></div></div>
                <div class="cheeks"><div class="cheek"></div><div class="cheek"></div></div>
            </div>
        </div>
        <div class="buttons">
            <button class="btn accept" id="acceptBtn">接受</button>
            <button class="btn reject" id="rejectBtn">拒绝</button>
        </div>
    </div>
<script>
    const face = document.getElementById('face');
    const leftPupil = document.getElementById('leftPupil');
    const rightPupil = document.getElementById('rightPupil');
    const acceptBtn = document.getElementById('acceptBtn');
    const rejectBtn = document.getElementById('rejectBtn');
    const mouth = face.querySelector('.mouth');
    const cheeks = face.querySelector('.cheeks');

    let rafId = null;
    let fleeingEnabled = false;
    let escapeCount = 0;
    const maxEscapes = 7;
    const minDistance = 80;

    document.addEventListener('mousemove', e => {
        if (rafId) cancelAnimationFrame(rafId);
        rafId = requestAnimationFrame(() => handleMouseMove(e));
    });

    function handleMouseMove(e) {
        const x = e.clientX, y = e.clientY;
        const f = face.getBoundingClientRect();
        const a = acceptBtn.getBoundingClientRect();
        const r = rejectBtn.getBoundingClientRect();

        // —— 保留眼球跟随 —— 
        const dx = x - (f.left + f.width / 2);
        const dy = y - (f.top + f.height / 2);
        const lim = 12;
        const mvX = Math.max(-lim, Math.min(lim, dx / 15));
        const mvY = Math.max(-lim, Math.min(lim, dy / 15));
        leftPupil.style.transform = rightPupil.style.transform = `translate(${mvX}px, ${mvY}px)`;

        // —— 先清除“happy”状态 —— 
        face.classList.remove('happy');

        // —— 如果拒绝按钮已隐藏，或鼠标在“接受”按钮上，都始终开心 —— 
        if (rejectBtn.style.display === 'none' || isInside(x, y, a)) {
			face.classList.remove("sad");
            face.classList.add('happy');
            return;
        }

        // —— 否则，按原逻辑动态调整嘴型和腮红 —— 
        const t = Math.max(0, Math.min(1, (x - a.right) / (r.left - a.right)));
        const hf = t, sf = 1 - t;
        mouth.style.borderRadius = `${40 * hf}px ${40 * hf}px ${40 * sf}px ${40 * sf}px`;
        mouth.style.height = `${30 + 10 * sf}px`;
        mouth.style.bottom = `${40 + 20 * hf}px`;
        cheeks.style.opacity = sf;
        face.style.background = `linear-gradient(135deg,#f8d568,#c9e265 ${30 + 70 * sf}%)`;
    }

    function isInside(x, y, rect) {
        return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;
    }

    // 点击后启用逃跑
    rejectBtn.addEventListener('click', () => {
        fleeingEnabled = true;
    });

    // 鼠标移入拒绝按钮时逃跑，同时放大“接受”按钮
    rejectBtn.addEventListener('mouseenter', e => {
        if (!fleeingEnabled) return;
        const w = rejectBtn.offsetWidth, h = rejectBtn.offsetHeight;
        const mx = e.clientX, my = e.clientY;
        let nx, ny, overlap;
        const aRect = acceptBtn.getBoundingClientRect();
        do {
            nx = Math.random() * (window.innerWidth - w);
            ny = Math.random() * (window.innerHeight - h);
            overlap = !(nx + w < aRect.left || nx > aRect.right || ny + h < aRect.top || ny > aRect.bottom);
        } while (Math.hypot(nx - mx, ny - my) < minDistance || overlap);

        rejectBtn.style.left = `${nx}px`;
        rejectBtn.style.top  = `${ny}px`;

        escapeCount++;
        const scale = 1 + 0.07 * escapeCount;
        acceptBtn.style.transform = `scale(${scale})`;
        acceptBtn.classList.add('bounce');
        acceptBtn.addEventListener('animationend', () => {
            acceptBtn.classList.remove('bounce');
        }, { once: true });

        // 达到最大逃跑次数后，隐藏拒绝按钮并始终切换为开心
		if (escapeCount >= maxEscapes) {
			rejectBtn.style.display = 'none';
			fleeingEnabled = false;

			setTimeout(() => {
				const aRect = acceptBtn.getBoundingClientRect();
				const centerX = aRect.left + aRect.width / 2;
				const centerY = aRect.top + aRect.height / 2;
				handleMouseMove({ clientX: centerX, clientY: centerY });
				
				// 固定为标准开心状态
				face.classList.remove('happy', 'sad');
				face.classList.add('happy');
				mouth.style.borderRadius = '0 0 40px 40px';
				mouth.style.height = '40px';
				mouth.style.bottom = '40px';
				cheeks.style.opacity = 1;
				face.style.background = 'linear-gradient(135deg,#f8d568,#c9e265)';

				face.classList.remove('happy', 'sad');
				face.classList.add('happy');
			}, 0); // 延时0毫秒执行
		}


    });

    acceptBtn.addEventListener('click', () => alert('太棒了！你接受了小树的邀请！'));
</script>

</body>
</html>
